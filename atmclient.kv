<Background@Image>:
    source: 'img/bg2.png'
    allow_stretch: True
    keep_ratio: False
    size_hint: 1, 1
<LanguageBar@GridLayout>:
    cols: 1
    width: 180
    spacing: 10
    size_hint: .2,1
    #Label:
    #    text: 'Language'
    #    font_size: 20
    #    height: 0.25
    #    color: 0,0,0,1
    Button:
        background_normal:'img/flags/large/EN.png'
        background_down:'img/flags/large/EN.png'
        on_press: app.change_language('English')
    Button:
        background_normal:'img/flags/large/FR.png'
        background_down:'img/flags/large/FR.png'
        on_press: app.change_language('French')
    Button:
        background_normal:'img/flags/large/DE.png'
        background_down:'img/flags/large/DE.png'
    Button:
        background_normal:'img/flags/large/IT.png'
        background_down:'img/flags/large/IT.png'
    Button:
        background_normal:'img/flags/large/ES.png'
        background_down:'img/flags/large/ES.png'
    Button:
        background_normal:'img/flags/large/PT.png'
        background_down:'img/flags/large/PT.png'
<MainButton@ColorDownButton>:
    color: 1,1,1,1
    background_color_normal: 0,0,0,0.4
    background_color_down: 0,0,0,0.6
    font_size: 30
<RootWidget>:
    root_manager: manager
    language: app.l
    ActionBar:
        id: _action
        size_hint: 1,0.1
        pos_hint: {'top':1}
        ActionView:
            use_separator: True
            ActionPrevious:
                text: ''
                split_str: ''
                title: 'Key Manager'
                with_previous: False

    MyScreenManager:
        id: manager
        pos_hint: {'top': 1}
        size_hint: 1,1
        Screen:
            name: 'LoadingScreen'
            Background:
            Label:
                text: 'Please Wait Connecting'
        WelcomeScreen:
        #VerifyScreen:
        ScanWalletScreen:
        BuyScreen:
        BuyFinishScreen:
        SellSelectScreen:
        SellFinishScreen:


<WelcomeScreen>:
    id: 'welcome_screen'
    name: 'welcome'
    Background:
    GridLayout:
        cols:2
        padding: 5
        spacing: 2
        LanguageBar:
        BoxLayout:
            orientation: 'vertical'
            padding: 40
            spacing: 10,0
            height: 10,0
            Label:
                text: '[b][font=MyriadPro-Bold.otf]{}[/font][/b]'.format(app.l["heading1"])
                markup: True
                halign: 'left'
                text_size: self.size
                size_hint: (1, None)
                color: 1,1,1,1
                font_size: 70
            Label:
                id: 'ticker_label'
                text: '[b]{} {} Fr.[/b]'.format(app.l["heading2"], round(float(app.price["buy_price"]), 2))
                markup: True
                halign: 'left'
                text_size: self.size
                size_hint: (1, None)
                height: 70
                color: 1,1,1,1
                font_size: 70
            #pricing/ticker grid
            GridLayout:
                cols: 3
                spacing: 10,0
                Label:
                    text: '[b]{}[/b]'.format(app.l["currency"])
                    markup: True
                    font_size: 40
                    color: 0,0,0,1
                    background_color: 0,0,0,0
                    canvas.before:
                        Color:
                            rgba: 1, 1, 1, 0.4
                        Rectangle:
                            size: self.size
                            pos: self.pos
                Label:
                    text: '[b]{}[/b]'.format(app.l["wesell"])
                    markup: True
                    font_size: 40
                    color: 0,0,0,1
                    canvas.before:
                        Color:
                            rgba: 1,1,1,0.4
                        Rectangle:
                            size: self.size
                            pos: self.pos
                Label:
                    text: '[b]{}[/b]'.format(app.l["webuy"])
                    markup: True
                    font_size: 40
                    color: 0,0,0,1
                    canvas.before:
                        Color:
                            rgba: 1,1,1,0.4
                        Rectangle:
                            size: self.size
                            pos: self.pos
                Label:
                    text: 'ETH'
                    font_size: 40
                    color: 0,0,0,1
                    canvas.before:
                        Color:
                            rgba: 1,1,1,0.2
                        Rectangle:
                            size: self.size
                            pos: self.pos
                Label:
                    id: 'btc_buy'
                    text: '{}'.format(round(float(app.price["buy_price"]), 2))
                    font_size: 40
                    color: 0,0,0,1
                    canvas.before:
                        Color:
                            rgba: 1,1,1,0.2
                        Rectangle:
                            size: self.size
                            pos: self.pos
                Label:
                    id: 'btc_sell'
                    text: '{}'.format(round(float(app.price["sell_price"]), 2))
                    font_size: 40
                    color: 0,0,0,1
                    canvas.before:
                        Color:
                            rgba: 1,1,1,0.2
                        Rectangle:
                            size: self.size
                            pos: self.pos
                Label:
                    text: ''
                    font_size: 40
                    color: 0,0,0,1
                    canvas.before:
                        Color:
                            rgba: 1,1,1,0.2
                        Rectangle:
                            size: self.size
                            pos: self.pos
                Label:
                    text: ''
                    font_size: 40
                    color: 0,0,0,1
                    canvas.before:
                        Color:
                            rgba: 1,1,1,0.2
                        Rectangle:
                            size: self.size
                            pos: self.pos
                Label:
                    text: ''
                    font_size: 40
                    color: 0,0,0,1
                    canvas.before:
                        Color:
                            rgba: 1,1,1,0.2
                        Rectangle:
                            size: self.size
                            pos: self.pos
                Label:
                    text: ''
                    font_size: 40
                    color: 0,0,0,1
                    canvas.before:
                        Color:
                            rgba: 1,1,1,0.2
                        Rectangle:
                            size: self.size
                            pos: self.pos
                Label:
                    text: ''
                    font_size: 40
                    color: 0,0,0,1
                    canvas.before:
                        Color:
                            rgba: 1,1,1,0.2
                        Rectangle:
                            size: self.size
                            pos: self.pos
                Label:
                    text: ''
                    font_size: 40
                    color: 0,0,0,1
                    canvas.before:
                        Color:
                            rgba: 1,1,1,0.2
                        Rectangle:
                            size: self.size
                            pos: self.pos
                Label:
                    text: ''
                    font_size: 40
                    color: 0,0,0,1
                    canvas.before:
                        Color:
                            rgba: 1,1,1,0.2
                        Rectangle:
                            size: self.size
                            pos: self.pos
                Label:
                    text: ''
                    font_size: 40
                    color: 0,0,0,1
                    canvas.before:
                        Color:
                            rgba: 1,1,1,0.2
                        Rectangle:
                            size: self.size
                            pos: self.pos
                Label:
                    text: ''
                    font_size: 40
                    color: 0,0,0,1
                    canvas.before:
                        Color:
                            rgba: 1,1,1,0.2
                        Rectangle:
                            size: self.size
                            pos: self.pos


            BoxLayout:
                height: 100
                spacing: 10
                padding: 0,10
                size_hint: (1, None)
                MainButton:
                    text: app.l["send"]
                    #on_release: app.root.current = 'verify'
                MainButton:
                    text: app.l["crypto"]
                    on_release: root.manager.current = 'scanwallet'; app.root.start_qr_thread()#; app.root.call_start_btm_process_task("BUY")
                MainButton:
                    text: app.l["cash"]
                    #on_release: app.open_settings()
                    on_release: root.manager.current = 'sellselect'

<ScanWalletScreen>:
    name: 'scanwallet'
    Background:
    GridLayout:
        cols:2
        padding: 5
        spacing: 2
        LanguageBar:
        BoxLayout:
            orientation: 'vertical'
            padding: 10,0
            spacing: 10,0
            Label:
                text: '[b][font=MyriadPro-Bold.otf]{}[/font][/b]'.format(app.l["walletscan"])
                markup: True
                halign: 'left'
                text_size: self.size
                size_hint: (1, None)
                color: 1,1,1,1
                font_size: 70
            Label:
                text: '[font=MyriadPro-Bold.otf][b]{}[/b][/font]'.format(app.l["presentqr"])
                halign: 'left'
                valign: 'top'
                height: 50
                line_height: 0.5
                markup: True
                size_hint: (1, None)
                color: 0,0,0,1
                font_size: 50
                text_size: self.size

            #pricing/ticker grid

            GridLayout:
                cols: 2
                Label:
                    text: app.l["cameraloading"]
                    width: 20
                    size_hint: (20, 50)
                    canvas:
                        Color:
                            rgba: 0, 0, 0, 0.4
                        Rectangle:
                            size: self.size
                            pos: self.pos

                Image:
                    source: 'img/phoneqr.png'
                    size_hint: (10, 10)
                    width: 10
                    height: 10
                    canvas.before:
                        Color:
                            rgba: 1, 1, 1, 0
                        Rectangle:
                            size: self.size
                            pos: self.pos

            BoxLayout:
                height: 100
                spacing: 10
                padding: 10
                size_hint: (1, None)
                Label:
                    text: ''
                Label:
                    text: ''
                Label:
                    text: ''
                MainButton:
                    text: app.l["cancel"]
                    on_release: app.root.stop_scanning(); root.manager.current = 'welcome'

<BuyScreen>:
    name: 'buy'
    Background:
    GridLayout:
        cols:2
        padding: 5
        spacing: 2
        LanguageBar:
        BoxLayout:
            orientation: 'vertical'
            padding: 10,0
            spacing: 10,0
            height: 10
            Label:
                text: '[b][font=MyriadPro-Bold.otf]{}[/font][/b]'.format(app.l["insertcash"])
                markup: True
                halign: 'left'
                text_size: self.size
                size_hint: (1, None)
                color: 1,1,1,1
                font_size: 70
            Label:
                text: '[font=MyriadPro-Bold.otf][b]{}[/b][/font]'.format(app.l["insertcashsub"])
                halign: 'left'
                valign: 'top'
                markup: True
                size_hint: (1, None)
                height: 50
                color: 0,0,0,1
                font_size: 50
                text_size: self.size
            Label:
                id: 'total_quote'
                text: '[font=MyriadPro-Bold.otf][b]{} Fr. = {} ETH[/b][/font]'.format(app.cashintotal, (round(app.cashintotal / app.price["buy_price"], 2)) if float(app.price["buy_price"]) > 0 else 0)
                halign: 'left'
                valign: 'top'
                markup: True
                size_hint: (1, None)
                height: 60
                color: 1,1,1,1
                font_size: 60
                text_size: self.size

            BoxLayout:
                orientation: 'vertical'
                spacing: 0,0
                canvas.before:
                    Color:
                        rgba: 1,1,1,0.2
                    Rectangle:
                        size: self.size
                        pos: self.pos
                Label:
                    text: '[font=MyriadPro-Bold.otf][b]{}[/b][/font]'.format(app.l["insertfiattitle"])
                    halign: 'left'
                    valign: 'top'
                    markup: True
                    size_hint: (1, None)
                    font_size: 26
                    color: 0,0,0,1
                BoxLayout:
                    spacing: 10,0
                    padding: 50,0
                    GridLayout:
                        cols: 2
                        spacing: 10,0
                        size_hint: .3,1
                        Label:
                            text: '10'
                            font_size: 30
                            color: 1,1,1,1
                        Label:
                            id: 'cashin10'
                            text: 'x{}'.format(app.cashin10)
                            font_size: 30
                            color: 1,1,1,1
                            halign: 'left'
                            canvas.before:
                                Color:
                                    rgba: 0, 0, 0, 0.2
                                Rectangle:
                                    size: self.size
                                    pos: self.pos
                        Label:
                            text: '20'
                            font_size: 30
                            color: 1,1,1,1
                        Label:
                            id: 'cashin20'
                            text: 'x{}'.format(app.cashin20)
                            font_size: 30
                            color: 1,1,1,1
                            canvas.before:
                                Color:
                                    rgba: 0, 0, 0, 0.2
                                Rectangle:
                                    size: self.size
                                    pos: self.pos
                        Label:
                            text: '50'
                            font_size: 30
                            color: 1,1,1,1
                        Label:
                            id: 'cashin50'
                            text: 'x{}'.format(app.cashin50)
                            font_size: 30
                            color: 1,1,1,1
                            canvas.before:
                                Color:
                                    rgba: 0, 0, 0, 0.2
                                Rectangle:
                                    size: self.size
                                    pos: self.pos
                        Label:
                            text: '100'
                            font_size: 30
                            color: 1,1,1,1
                        Label:
                            id: 'cashin100'
                            text: 'x{}'.format(app.cashin100)
                            font_size: 30
                            color: 1,1,1,1
                            canvas.before:
                                Color:
                                    rgba: 0, 0, 0, 0.2
                                Rectangle:
                                    size: self.size
                                    pos: self.pos
                        Label:
                            text: '200'
                            font_size: 30
                            color: 1,1,1,1
                        Label:
                            id: 'cashin200'
                            text: 'x{}'.format(app.cashin200)
                            font_size: 30
                            color: 1,1,1,1
                            canvas.before:
                                Color:
                                    rgba: 0, 0, 0, 0.2
                                Rectangle:
                                    size: self.size
                                    pos: self.pos
                    BoxLayout:
                        orientation: 'vertical'
                        Label:
                            text: '[font=MyriadPro-Bold.otf][b]1 ETH = {} CHF[/b][/font]'.format(round(float(app.price["buy_price"]), 2))
                            markup: True
                            halign: 'right'
                            font_size: 38
                            text_size: self.size
                            color: 1,1,1,1

                        Label:
                            text: '[font=MyriadPro-Bold.otf][b]{} 500 Fr.[/b][/font]'.format(app.l["limit"])
                            markup: True
                            halign: 'right'
                            font_size: 40
                            text_size: self.size
                            color: 1,1,1,1

                Label:
                    padding: 0,0
                    spacing: 0
                    id: 'to_address'
                    text: app.clientaddress
                    font_size: 26
                    color: 1,1,1,1

            BoxLayout:
                height: 100
                spacing: 10
                padding: 10
                size_hint: (1, None)
                ColorDownButton:
                    text: ''#app.l["cancel"]
                    color: 1,1,1,0
                    background_color: 0,0,0,0
                    background_color_normal: 0,0,0,0
                    background_color_down: 0,0,0,0
                    font_size: 30
                # ColorDownButton:
                #     text: 'SCAN'
                #     color: 1,1,1,0
                #     background_color: 0,0,0,0
                #     background_color_normal: 0,0,0,0
                #     background_color_down: 0,0,0
                #     font_size: 30
                MainButton:
                    text: app.l["finish"]
                    on_release: root.manager.current = 'buyfinish'; app.process_buy(); app.stop_cashin();

<BuyFinishScreen>:
    name: 'buyfinish'
    Background:
    GridLayout:
        cols: 2
        padding: 5
        spacing: 2
        LanguageBar:
        BoxLayout:
            orientation: 'vertical'
            padding: 40
            spacing: 10
            height: 10
            Label:
                text: '[b][font=MyriadPro-Bold.otf]{}[/font][/b]'.format(app.l["buyfinishheading1"])
                markup: True
                halign: 'left'
                text_size: self.size
                size_hint: (1, None)
                color: 1,1,1,1
                font_size: 70
            Label:
                text: '[font=MyriadPro-Bold.otf][b]{}[/b][/font]'.format(app.l["buyfinishheading2"])
                halign: 'left'
                valign: 'top'
                markup: True
                size_hint: (1, None)
                color: 0,0,0,1
                font_size: 50
                text_size: self.size
            #confirmation box
            BoxLayout:
                id: 'amount_sending_finished'
                orientation: 'vertical'
                size_hint: (1, None)
                Label:
                    text: app.l["buyfinishedamountsending"].format((round(app.cashintotal / app.price["buy_price"], 2)) if float(app.price["buy_price"]) > 0 else 0)
                    color: 0,0,0,1
            BoxLayout:
                height: 100
                spacing: 10
                size_hint: (1, None)
                ColorDownButton:
                    text: ''
                    color: 1,1,1,0
                    background_color: 0,0,0,0
                    background_color_normal: 0,0,0,0
                    background_color_down: 0,0,0,0
                    font_size: 30
                ColorDownButton:
                    text: ''
                    color: 1,1,1,0
                    background_color: 0,0,0,0
                    background_color_normal: 0,0,0,0
                    background_color_down: 0,0,0,0
                    font_size: 30
                MainButton:
                    text: app.l["close"]
                    on_release: root.manager.current = 'welcome'

<SellSelectScreen>:
    name: 'sellselect'
    Background:
    GridLayout:
        cols:2
        padding: 5
        spacing: 2
        LanguageBar:
        BoxLayout:
            orientation: 'vertical'
            padding: 10,0
            spacing: 10,0
            height: 10
            Label:
                text: '[font=MyriadPro-Bold.otf][b]{}[/b][/font]'.format(app.l["sellheading"])
                halign: 'left'
                valign: 'top'
                markup: True
                size_hint: (1, None)
                height: 50
                color: 0,0,0,1
                font_size: 50
                text_size: self.size
            Label:
                text: '[font=MyriadPro-Bold.otf][b]220 Fr. = 0.91245678 BTC[/b][/font]'
                halign: 'left'
                valign: 'top'
                markup: True
                size_hint: (1, None)
                height: 60
                color: 1,1,1,1
                font_size: 60
                text_size: self.size

            BoxLayout:
                orientation: 'vertical'
                spacing: 10,0
                canvas.before:
                    Color:
                        rgba: 1,1,1,0.2
                    Rectangle:
                        size: self.size
                        pos: self.pos
                BoxLayout:
                    spacing: 10,0
                    padding: 20
                    GridLayout:
                        cols: 3
                        spacing: 10
                        #size_hint: .3,1
                        MainButton:
                            text: '10 Fr.'
                            on_release: app.root.generate_qr(); root.manager.current = 'sellfinish'
                        MainButton:
                            text: '150 Fr.'
                            ###on_release: app.root.current = 'verify'
                        Label:
                            markup: True
                            text: '[color=ffffff]{}[/color] [color=1c6434]{}CHF[/color]'.format(app.l["quoteheading"], round(float(app.price["buy_price"]), 2))
                            font_size: 35
                        MainButton:
                            text: '20 Fr.'
                            ###on_release: app.root.current = 'verify'
                        MainButton:
                            text: '200 Fr.'
                            ###on_release: app.root.current = 'verify'
                        Label:
                            markup: True
                            text: '[color=ffffff]{}[/color]  [color=c11d24]500CHF[/color]'.format(app.l["limit"])
                            font_size: 35
                        MainButton:
                            text: '50 Fr.'
                            ###on_release: app.root.current = 'verify'
                        MainButton:
                            text: '400 Fr.'
                            ###on_release: app.root.current = 'verify'
                        Label:
                            text:''
                        MainButton:
                            text: '100 Fr.'
                            ###on_release: app.root.current = 'verify'
                        MainButton:
                            text: app.l["other"]
                            ###on_release: app.root.current = 'verify'
            BoxLayout:
                height: 100
                spacing: 10
                padding: 10
                size_hint: (1, None)
                MainButton:
                    text: app.l["cancel"]
                    on_release: root.manager.current = 'welcome'
                Label:
                    text: ''

<SellFinishScreen>:
    name: 'sellfinish'
    Background:
    GridLayout:
        cols: 2
        padding: 5
        spacing: 2
        LanguageBar:
        BoxLayout:
            orientation: 'vertical'
            padding: 40
            spacing: 10
            height: 10
            Label:
                text: '[b][font=MyriadPro-Bold.otf]{}[/font][/b]'.format(app.l["sellfinishheading1"])
                markup: True
                halign: 'left'
                text_size: self.size
                size_hint: (1, None)
                color: 1,1,1,1
                font_size: 70
            Label:
                text: '[font=MyriadPro-Bold.otf][b]{}[/b][/font]'.format(app.l["sellfinishheading2"])
                halign: 'left'
                valign: 'top'
                markup: True
                size_hint: (1, None)
                color: 0,0,0,1
                font_size: 50
                text_size: self.size
            Image:
                id: 'generate_qr'

            #confirmation box
            BoxLayout:
                id: 'amount_selling_finished'
                orientation: 'vertical'
                size_hint: (1, None)
                Label:
                    text: app.l["sellfinishedamountsending"].format((round(app.cashintotal / app.price["buy_price"], 2)) if float(app.price["buy_price"]) > 0 else 0)
                    color: 0,0,0,1

            BoxLayout:
                height: 50
                spacing: 10
                size_hint: (1, None)
                ColorDownButton:
                    text: ''
                    color: 1,1,1,0
                    background_color: 0,0,0,0
                    background_color_normal: 0,0,0,0
                    background_color_down: 0,0,0,0
                    font_size: 30
                ColorDownButton:
                    text: ''
                    color: 1,1,1,0
                    background_color: 0,0,0,0
                    background_color_normal: 0,0,0,0
                    background_color_down: 0,0,0,0
                    font_size: 30
                MainButton:
                    text: app.l["close"]
                    on_release: root.manager.current = 'welcome'
